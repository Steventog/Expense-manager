<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des dépenses</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Fixe la navbar en haut */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1030; /* Pour qu'elle reste au-dessus des autres éléments */
        }

        /* Fixe la sidebar à gauche */
        .sidebar {
            position: fixed;
            top: 56px; /* Hauteur de la navbar */
            left: 0;
            height: calc(100vh - 56px); /* Hauteur de la fenêtre - la hauteur de la navbar */
            overflow-y: auto; /* Ajoute un défilement si le contenu de la sidebar dépasse */
        }

        /* Contenu principal avec espace pour navbar et sidebar */
        .main-content {
            margin-top: 56px; /* Hauteur de la navbar */
            margin-left: 25%; /* Largeur de la sidebar (ajustez si nécessaire) */
        }

        /* Assurez-vous que la sidebar a une largeur cohérente */
        .sidebar {
            width: 25%; /* Largeur de la sidebar */
        }
    </style>
    <style>
        .sidebar {
            background: #f8f9fa;
        }
    
        .nav-link {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
    
        .nav-link:hover, .nav-link:focus {
            background-color: #C4F3CEFF;
            transform: translateX(10px);
        }
    
        .hover-shadow:hover {
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
        }
    
        .nav-link span {
            font-size: 16px;
            font-weight: 500;
        }
    
        .p-3 {
            padding: 12px 16px;
        }
    </style>
    
</head>
<body>
    {% load static %}
    
    <!-- Navbar principale -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top shadow-sm">
        <div class="container-fluid">
            <!-- Lien Home à gauche -->
            <a class="navbar-brand" href="{% url 'home' %}">Home</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <!-- Liens à droite -->
            {% if user.is_authenticated %}
                <div class="collapse navbar-collapse justify-content-end ml-3" id="navbarSupportedContent">
                    <!-- Filtres d'années et de mois -->
                    <form method="get" action="" class="d-flex">
                        <select name="year" class="form-select mx-2" onchange="this.form.submit()">
                            <option value="">Toutes les années</option>
                            {% for date in years_months|dictsortreversed:"year" %}
                                <option value="{{ date|date:'Y' }}" {% if selected_year == date|date:'Y' %}selected{% endif %}>
                                    {{ date|date:'Y' }}
                                </option>
                            {% endfor %}
                        </select>
                        <select name="month" class="form-select mx-2" onchange="this.form.submit()">
                            <option value="">Tous les mois</option>
                            {% for date in years_months %}
                                <option value="{{ date|date:'m' }}" {% if selected_month == date|date:'m' %}selected{% endif %}>
                                    {{ date|date:'F' }}
                                </option>
                            {% endfor %}
                        </select>
                    </form>
        
                    <!-- Recherche -->
                    <form class="d-flex mx-2 my-2 my-lg-0" method="GET" action="" id="searchForm">
                        <input class="form-control me-2" type="search" name="search" placeholder="Nom ou prix" aria-label="Search" value="{{ request.GET.search }}">
                        <button class="btn btn-outline-success" type="submit">Rechercher</button>
                    </form>
        
                    <!-- Utilisateur -->
                    <div class="navbar-nav nav-item ">
                        <a class="nav-link " href="#" >
                            {{ user.username }}
                        </a>
                    
                    </div>
                </div>
            {% endif %}

        </div>
    </nav>
    
    <!-- Sidebar -->
    <div class="sidebar bg-light shadow p-3">
        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            {% if user.is_authenticated %}
                <a class="nav-link mb-2 d-flex align-items-center p-3 rounded-3 hover-shadow" href="{% url 'home' %}">
                    <img src="{% static 'icons/home.svg' %}" alt="Dashboard" class="me-2" style="width: 20px; height: 20px;">
                    <span>Dashboard</span>
                </a>
                <a class="nav-link mb-2 d-flex align-items-center p-3 rounded-3 hover-shadow" href="{% url 'add_budget' %}">
                    <img src="{% static 'icons/plus-circle.svg' %}" alt="Ajouter un budget" class="me-2" style="width: 20px; height: 20px;">
                    <span>Ajouter un budget</span>
                </a>
                
                <a class="nav-link mb-2 d-flex align-items-center p-3 rounded-3 hover-shadow" href="{% url 'add_expense' %}">
                    <img src="{% static 'icons/cash.svg' %}" alt="Ajouter une dépense" class="me-2" style="width: 20px; height: 20px;">
                    <span>Ajouter une dépense</span>
                </a>
                <a class="nav-link mb-2 d-flex align-items-center p-3 rounded-3 hover-shadow" href="{% url 'history' %}">
                    <img src="{% static 'icons/stats.svg' %}" alt="Historique" class="me-2" style="width: 20px; height: 20px;">
                    <span>Statistiques</span>
                </a>

                <a class="nav-link mb-2 d-flex align-items-center p-3 rounded-3 hover-shadow" href="{% url 'history' %}">
                    <img src="{% static 'icons/history.svg' %}" alt="Historique" class="me-2" style="width: 20px; height: 20px;">
                    <span>Historique</span>
                </a>
                
                <form method="post" action="{% url 'logout' %}" class="mt-3">
                    {% csrf_token %}
                    <button type="submit" class="nav-link mb-2 d-flex align-items-center p-3 rounded-3 hover-shadow">
                        <img src="{% static 'icons/logout.svg' %}" alt="Historique" class="me-2" style="width: 20px; height: 20px;">
                        Déconnexion
                    </button>
                </form>
            {% else %}
                <a class="nav-link mb-2 p-3 rounded-3 hover-shadow" href="{% url 'register' %}">
                    Inscription
                </a>
                <a class="nav-link mb-2 p-3 rounded-3 hover-shadow" href="{% url 'login' %}">
                    Connexion
                </a>
            {% endif %}
        </div>
    </div>
    
    
    

    <!-- Contenu principal -->
    <div class="main-content">
        <main class="px-4">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
